<!DOCTYPE html>
<html>
<head>
    <title>Image Processing App</title>
    <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>
    <link rel="stylesheet" type="text/css" href="style.css">
    <script type="text/javascript" src="javascript.js"></script>
</head>
<body>
<div id="layout">


    <div id="info">
        <h2>Serverless GIF generation on AWS</h2>
        <p>I created this site to generate some cool GIFs starting from an image, applying some custom algorithms. </p>
        <p>The site is hosted on AWS, has a complete serverless architechture, and uses
            S3, ApiGateway, Lambda, SNS and SQS. For a site this simple it´s clearly an overkill. It´s mostly created as
            a
            way to
            consolidate my AWS learning. The source code and a detailed explanation can be found on GitHub.
        </p>
    </div>

    <div id="UPLOAD">
        <div class="container">
            <h3>Upload you photo and generate 3 GIFs, as shown in the examples!</h3>
            <form id="form" enctype="multipart/form-data">
                <div class="input-group">
                    <label for="files">Select files</label>
                    <input id="file" type="file" multiple/>
                </div>
                <button class="submit-btn" type="submit">Upload</button>
            </form>
        </div>
    </div>


    <div id="gif-examples">
        <div >
            <img id="GifImg" width="600">
            <div >
                <button id="Button">Download gif</button>
            </div>
        </div>

        <div >
            <img id="GifImg2" width="600">
            <div >
                <button id="Button2">Download gif</button>
            </div>
        </div>

        <div >
            <img id="GifImg3" width="600">
            <div >
                <button id="Button3">Download gif</button>
            </div>
        </div>
    </div>





    <script>
        (async () => {
            await settingGif("makeGifRapido.gif", "Button", "GifImg")
            await settingGif("makeGifRapido.gif", "Button2", "GifImg2")
            await settingGif("makeGifRapido.gif", "Button3", "GifImg3")
        })()






        const form = document.getElementById("form");
        const inputFile = document.getElementById("file");
        var formData = new FormData();

        const handleSubmit = (event) => {
            event.preventDefault();

            formData = new FormData();
            formData.append("files", inputFile.files[0]);
            console.log("input file: " + inputFile.files[0])


            fetch("https://x7t7f93zpk.execute-api.us-east-1.amazonaws.com/test1/fileupload", {
                method: "post",
                body: formData,
            })
                .then(response => response.json())
                .then(json => {
                    console.log(json)
                    startShortPollingForGif(json.id)
                })
                .catch(
                    error => ("Something went wrong!", error))
                .finally(() => {
                    formData = new FormData();
                })

        };

        form.addEventListener("submit", handleSubmit)
    </script>
</body>


<script>


    /*

<!--
    <div id="results">
        <div>
            <h1>Single File Uploadd</h1>
            <input type="file" id="file-uploader" accept=".jpg, .png">
            <p>Upload a file and see the output in browser console</p>

            <p id="feedback"></p>
        </div>
-->

    /* const fileUploader = null;
        fileUploader.addEventListener('change', (event) => {
            const files = event.target.files;
            const file = event.target.files[0];
            console.log('files', files);

            // show the upload feedback
            const size = file.size;
            const feedback = document.getElementById('feedback');
            var msg = `File ${files[0].name} uploaded successfully!`;

            if (size > 1024 * 1024) {
                msg = `<span style="color:red;">The allowed file size is 1MB. The file you are trying to upload is of ${returnFileSize(size)}</span>`;
            } else {
                msg = `<span style="color:green;"> A ${returnFileSize(size)} file has been uploaded successfully. </span>`;
            }

            feedback.innerHTML = msg;
        });

        function returnFileSize(number) {
            if (number < 1024) {
                return number + 'bytes';
            } else if (number >= 1024 && number < 1048576) {
                return (number / 1024).toFixed(2) + 'KB';
            } else if (number >= 1048576) {
                return (number / 1048576).toFixed(2) + 'MB';
            }
        }*/


</script>

</html>
